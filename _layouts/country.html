---
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ page.name }} – Atlas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ '/assets/css/country.css' | relative_url }}">
</head>
<body>

<main class="country-page">

    <!-- BACK LINK (href færdiggøres via JS) -->
    <a href="{{ '/' | relative_url }}" class="back-to-atlas" id="back-to-atlas">
        ← Back to atlas
    </a>

    <header class="country-header">
        <img
                src="{{ '/assets/flags/' | relative_url }}{{ page.iso2 | default: 'xx' | downcase }}.svg"
                alt="{{ page.name }} flag"
                class="country-flag"
                onerror="this.style.display='none'">

        <div>
            <h1>{{ page.name }}</h1>
            {% if page.continent %}
            <div class="continent">{{ page.continent }}</div>
            {% endif %}
        </div>
    </header>

    <div class="country-layout">

        <aside class="country-sidebar">

            {% if page.language and page.language.size > 0 %}
            <div class="fact">
                <label>Language</label>
                <div class="value">{{ page.language | join: ", " }}</div>
            </div>
            {% endif %}

            {% if page.capital %}
            <div class="fact">
                <label>Capital</label>
                <div class="value">{{ page.capital }}</div>
            </div>
            {% endif %}

            {% if page.best_months %}
            <div class="fact">
                <label>Best months to visit</label>
                <ul>
                    {% assign month_names = "January,February,March,April,May,June,July,August,September,October,November,December" | split: "," %}
                    {% for m in page.best_months %}
                    {% assign idx = m | minus: 1 %}
                    <li>{{ month_names[idx] }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if page.ok_months %}
            <div class="fact">
                <label>Okay months</label>
                <ul>
                    {% assign month_names = "January,February,March,April,May,June,July,August,September,October,November,December" | split: "," %}
                    {% for m in page.ok_months %}
                    {% assign idx = m | minus: 1 %}
                    <li>{{ month_names[idx] }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if page.budget and (page.budget.dkk or page.budget.eur) %}
            <div class="fact">
                <label>Budget per person for 7 days</label>
                {% if page.budget.dkk %}
                <div class="value">{{ page.budget.dkk }} DKK</div>
                {% endif %}
                {% if page.budget.eur %}
                <div class="budget-secondary">{{ page.budget.eur }} EUR</div>
                {% endif %}
            </div>
            {% endif %}

            {% if page.currency and page.currency.rates %}
            <div class="fact">
                <label>Currency</label>

                <div class="value">
                    {{ page.currency.name }}
                    <span class="currency-meta">
                        {{ page.currency.symbol }} ({{ page.currency.code }})
                    </span>
                </div>

                <div class="budget-secondary">
                    1 {{ page.currency.name }} =
                    {{ page.currency.rates.per_1.eur }} EUR /
                    {{ page.currency.rates.per_1.dkk }} DKK
                </div>
            </div>
            {% endif %}

            {% if page.tags and page.tags.size > 0 %}
            <div class="fact">
                <label>Tags</label>

                <ul class="tags">
                    {% for tag in page.tags %}
                    <li>
                        <!-- TAG LINK (færdiggøres via JS) -->
                        <a
                                href="{{ '/' | relative_url }}"
                                class="tag-chip"
                                data-tag="{{ tag }}"
                        >
                            {{ tag | replace: "_", " " }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

        </aside>

        <section class="country-content">
            {{ content }}
        </section>

    </div>

</main>

<!-- ========================= -->
<!-- SCRIPT: CONTEXT HANDLING -->
<!-- ========================= -->
<script>
    // 1. Find hvor brugeren kom fra
    const params = new URLSearchParams(window.location.search);
    const fromView = params.get("from") || "map";

    // 2. Fix "Back to atlas"
    const backLink = document.getElementById("back-to-atlas");
    if (backLink) {
        backLink.href = `{{ '/' | relative_url }}?view=${fromView}`;
    }

    // 3. Fix tag links
    document.querySelectorAll("[data-tag]").forEach(link => {
        const tag = link.dataset.tag;
        link.href = `{{ '/' | relative_url }}?tag=${encodeURIComponent(tag)}&view=${fromView}`;
    });
</script>

</body>
</html>
